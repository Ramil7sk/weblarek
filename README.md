# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

##### Данные
В приложении используется две сущности, которые описывают данные. Их можно описать следующими интерфейсами:

##### Интерфейс IProduct

Описывает структуру объекта товара, который используется в приложении.

Поля интерфейса:
`id: string` - уникальный идентификатор товара.
`description: string` - описание товара.
`image: string` - ссылка на изображение товара.
`title: string` - название товара.
`category: string` - категория, к которой относится товар.
`price: number | null` - цена товара. Может быть null, если цена не задана.

##### Интерфейс IBuyer

Описывает структуру объекта покупателя, который используется в приложении.

Поля интерфейса:
`payment: TPayment` - метод оплаты (тип TPayment определяется отдельно).
`email: string` - электронная почта покупателя.
`phone: string` - контактный телефон покупателя.
`address: string` - почтовый адрес покупателя.

###### Модели данных
Для учёта данных в приложении используются 3 класса, которые разделены между собой по смыслу и зонам ответственности.

###### Класс Products
Хранит все товары, которые можно купить в приложении.

Конструктор класса не принимает параметров.

Поля класса:
`products: IProduct[]` — массив всех товаров, полученных с сервера
`selectedProduct: IProduct | null` — товар, выбранный пользователем для подробного просмотра

Методы класса:
`setProducts(products: IProduct[]): void` - сохраняет массив товаров, переданный в параметрах метода, во внутреннее свойство модели.
`getProducts(): IProduct[]` - возвращает массив всех товаров.
`getProductById(id: string): IProduct | undefined` - принимает идентификатор товара и возвращает товар с этим id или undefined, если товара нет.
`setSelectedProduct(product: IProduct): void` - сохраняет товар, выбранный для подробного отображения.
`getSelectedProduct(): IProduct | null` - возвращает текущий выбранный товар или null, если он не был установлен.

###### Класс Cart
Хранит товары, которые пользователь выбрал для покупки.

Конструктор класса не принимает параметров.

Поля класса:
`items: IProduct[]` - массив товаров, добавленных в корзину.

Методы класса:
`getItems(): IProduct[]` - возвращает массив товаров в корзине.
`addItem(product: IProduct): void` - добавляет товар в корзину.
`removeItem(product: IProduct): void` - удаляет товар, переданный в параметре, если он находится в корзине.
`clear(): void` - очищает корзину.
`getTotal(): number` - возвращает общую стоимость всех товаров в корзине, если у товара цена null, цена считается равной 0.
`getCount(): number` - возвращает количество товаров в корзине.
`hasItem(id: string): boolean` - проверяет, есть ли товар с переданным id в корзине.

###### Класс Buyer
Хранит данные покупателя, которые тот должен указать при оформлении заказа и выполняет валидацию.

Конструктор класса не принимает параметров.

Поля класса:
`buyer: Partial<IBuyer>` - объект данных покупателя, заполняемый частично.

Методы класса:
`setBuyerData(data: Partial<IBuyer>): void` - сохраняет данные покупателя, переданные в параметре, метод добавляет новые данные к существующим, не удаляя уже сохранённые.
`getBuyerData(): Partial<IBuyer>` - возвращает объект с текущими данными покупателя.
`clear(): void` - очищает все данные покупателя.
`validate(): Partial<Record<keyof IBuyer, string>>` - проверяет корректность всех полей покупателя, возвращает объект с ошибками, где ключи соответствуют полям IBuyer, а значения — текст ошибки.Если поле валидно, оно не появляется в объекте.

###### Слой коммуникации
Класс будет использовать композицию, чтобы выполнить запрос на сервер «Веб-ларёк» с помощью метода get класса Api и будет получать с сервера объект с массивом товаров.

`constructor(api: IApi)` — принимает объект, реализующий интерфейс IApi, и сохраняет его для выполнения HTTP-запросов.

Поля класса:
`api: IApi` — объект, через который выполняются запросы get и post.

Методы класса:
`getProducts(): Promise<IProduct[]>` — делает GET-запрос на эндпоинт /product/ и возвращает массив товаров.
`sendOrder(order: IOrderRequest): Promise<IOrderResponse>` — делает POST-запрос на эндпоинт /order/ и отправляет данные о заказе, полученные в параметре.

###### Слой Представления (View)
Все классы представления отвечают за отображение внутри контейнера элемента передаваемых в них данных  и наследуются от класса Component.

###### Класс Header
Отвечает за отображение шапки сайта. Устанавливает значение счётчика корзины и устанавливает слушатель на значок корзины. 

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов шапки.

Поля класса:
`counterElement: HTMLElement` — DOM-элемент, отображающий количество товаров в корзине.
`basketButton: HTMLButtonElement` — кнопка корзины в шапке приложения.

Методы класса:
`set counter(value: number)` - устанавливает значение счетчика количества товаров в корзине.

События класса:
При клике на кнопку корзины генерируется событие `basket:open` через систему событий.

###### Класс Gallery
Отвечает за отображение списка карточек товаров на странице приложения.

Конструктор:
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`catalogElement: HTMLElement` - элемент каталога.

Методы класса:
`set catalog(items: HTMLElement[])` - устанавливает в контейнере карточки товаров.

###### Класс Modal
Отвечает за отображение модального окна, содержимое которого меняется в зависимости от выбранного для отображения из разметки шаблона.

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`contentElement: HTMLElement` - элемент модального окна.
`closeButton: HTMLButtonElement` - кнопка закрытия модального окна.

Методы класса:
`set content(item: HTMLElement)` - устанавливает в контейнере переданный элемент.
`open()` - отвечает за открытие модального окна.
`close()` - отвечает за закрытие модального окна.

События класса:
При нажатии на кнопку закрытия формы генерируется событие `modal:close`.

###### Класс Success
Отвечает за отображение окна успешной покупки. Устанавливает слушатель на кнопку продолжения покупок.

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`successCloseButton: HTMLButtonElement` - кнопка модального окна.
`descriptionElement: HTMLElement` - поле хранящее сумму совершнной покупки.

Методы класса:
`set total(value: number)` - устанавливает сумму совершенной покупки.

События класса:
При нажатии на кнопку "За новыми покупками" окно закрывается и отображается стартовая страница приложения.

  ###### Класс Basket
  Отвечает за отображение карзины с выбранными товарами. Отображает список карточек товаров и суммарную стоимость товаров в корзине

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`basketList: HTMLElement` - список для отображения элементов товаров в корзине.
`basketButton: HTMLButtonElement` - кнопка для оформления заказа в корзине.
`basketPrice: HTMLElement` - стоимость товаров в корзине.

Методы класса:
`set content(items: HTMLElement[])` - устанавливает в контейнер переданный в параметре массив карточек товаров или если массив пуст выводит сообщение об отсутствии товаров в корзине.
`set price(value: number)` - устанавливает суммарную стоимость корзины.

События класса:
При нажатии на кнопку "Оформить" создается событие `basket:submit`.

###### Класс Card
Класс Card является базовым и используется в качестве родительского для классов GallerCard, ModalCard и BasketCard, которые реализуют различные варианты отображения карточки товара.

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`protected itemTitle: HTMLElement;` - хранит заголовок карточки товара.
`protected itemPrice: HTMLElement;` - хранит цену товара.
`protected itemId: string;` - хранит id товара.

Методы класса:
`set title(value: string)` - устанавливает наименование товара в карточе.
`set price(value: number | null)` - устанавливает стоимость товара в карточке.

###### Класс GalleryCard
Является дочерним классом класса Card. Отвечает за отображение карточки товара в каталоге товаров. Устанавливает слушатель на клик по карточке.

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`cardCategory: HTMLElement ` - хранит категорию товара в карточке.
`cardImage: HTMLImageElement` - хранит ссылку на изображене товара.

Методы класса:
`set image(value: string)` - устанавливает ссылку на изображение товара.
`set category(value: string)` - устанавливает категорию товара.

События класса:
При клике на карточку товара создается событие `card:open`.

###### Класс ModalCard
Является дочерним классом класса Card. Отвечает за отображение карточки товара в модальном окне.

Конструктор:
`events: IEvents` — объект для работы с системой событий приложения.
`container: HTMLElement` — DOM-элемент, внутри которого происходит поиск элементов.

Поля класса:
`cardDescription: HTMLElement` - хранит описание товара.
`cardButton: HTMLButtonElement` - хранит текст кнопки в карточке товара.

Методы:
`set description(value: string)` - устанавливает описание в карточке товара.
`set buttonText(value: string)` - устанавливает текст кнопки в карточке товара.

События класса:
При нажатии на кнопку "В корзину" создается событие `selectedItem:basketAction`.

###### Класс BasketCard

Является дочерним классом класса Card. Отвечает за отображение товара в корзине. Устанавливает слушатель событий кнопки удаления товара из корзины.

Поля класса:
`itemIndex: HTMLElement` - хранит иднек товара в корзине.
`itemButton: HTMLButtonElement` - кнопка удаления товара из корзины.

Методы класса:
`set itemNumber(value: number)` -  устанавливает порядковый номер товара в корзине.

События класса:
При нажатии на кнопку удаления товара из корзины создается событие `selectedItem:basketAction`.

###### Класс Form

Является родителем для классов OrderForm и ContactForm, которые отвечают за отображение форм покупки. Устанавливает слушатель события input на поля формы и слушатель клика на отправку формы.

Поля класса:
`buttonElement: HTMLButtonElement` - кнопка формы.
`errorElement: HTMLElement` - текстовое поле, для отображени ошибок валидации.

Методы класса:
`onInputChange(field: keyof T, value: string)` - генерирует события с разными названиями и параметрами, в зависимости от передаваемых ему параметров
`set valid(value: boolean)` - изменяет состояние кнопки в зависимости от валидации формы
`set errors(value: string[])` - выводит текст ошибок при неправильном заполнении формы

События класса:
Устанавливаются слушатели клика по кнопке и ввода в полях формы, в зависимости от передаваемых параметров и валидации формы.

###### Класс OrderForm

Дочерний класс Form<Partial<ICustomer>>. Представляет форму оформления заказа. Расширяет базовую форму, добавляя выбор типа оплаты и ввод адреса доставки.

Поля класса:
`cardButtonElement: HTMLButtonElement` — кнопка выбора оплаты картой.
`cashButtonElement: HTMLButtonElement` — кнопка выбора оплаты наличными.
`adressInput: HTMLInputElement` — поле ввода адреса доставки.

Методы класса:
`changeButtonState(isCard: boolean, isCash: boolean)` — переключает визуальное состояние выбранного способа оплаты.
`set address(value: string)` — устанавливает значение поля адреса доставки.

События класса:
При нажатии на кнопки выбора оплаты вызывается `onInputChange`, обновляющий поле payment формы.

###### Класс ContactForm

Является дочерним классом Form. Отвечает за отображение контактной информации.

Поля класса:
`emailInput: HTMLInputElement` - поле ввода email адреса.
`phoneInput: HTMLInputElement` - поле ввода телефона.

Методы класса:
`set email(value: string)` - устанавливает email пользователя.
`set phone(value: string)` - устанавливает номер телефона пользователя.